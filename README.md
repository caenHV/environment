# Запуск caen_tools

## Идея
У нас четыре микросервиса: `WebService`, `Monitor`, `DeviceBackend`, `SystemCheck`.
На данном этапе запустим их все на одной машине, но каждый в своём отдельном контейнере.

Технически для этого нужно сконфигурировать фаил для `docker compose` (*compose.yaml*), 
в котором описаны настройки отдельных докер-контейнеров.

Описание самого контейнера находится в файле *Dockerfile*

Пользовательская конфигурация сервисов `caen_tools` лежит в *config.ini*

Директория *store/* монтируется к контейнерам, в ней можно сохранять базы данных, конфигурационные файлы и необходимые логи.

Также необходима директория *soft/*, содержащая необходимые драйверы для работы с CAEN.

## Как запустить

* Скопировать всё содержимое текущей директории в рабочую директорию.
* Поднять микросервисы (`-d` в detach режиме, т.е. в фоне; `--build` пересобрать контейнеры, если что-то в них изменилось)
```bash
docker compose up --build -d
```

Всё должно работать, на `8000` порте рабочей машины должен появиться фронтенд интерфейс.

* Остановить микросервисы можно командой
```bash
sudo docker compose stop
```
* Удалить образы после этого можно командой
```bash
sudo docker compose down
```
  Перезапустить образы можно коммандой
```bash
sudo docker compose restart
```

## Переход к release режиму
(работа с реальной CAEN board)

1. В *config.ini* установить флаг false для опции fake_board в разделе `devback`
1. В *compose.yaml* установить флаг true для опции privileged сервиса `devback`

## Полезные ссылки
* [Официальный сайт docker compose](https://docs.docker.com/compose/gettingstarted/)
* [Docker для новичков. Что нужно знать о docker compose](https://habr.com/ru/articles/804331/)
